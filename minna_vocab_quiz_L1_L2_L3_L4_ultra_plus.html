<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>å¤§å®¶çš„æ—¥æœ¬èª N5ï½œL1â€“L4 å–®å­—å°è€ƒï¼ˆå›ºå®šé¡Œåº«ï¼‰</title>
  <style>
    :root{ --bg1:#fff6dc; --bg2:#ffeec5; --paper:#fff7da; --ink:#1d1608; --accent:#d9983d; --accent-d:#b67a2f; --ok:#2e7d32; --bad:#c62828; --shadow:0 10px 20px rgba(0,0,0,.08); }
    html,body{height:100%}
    body{margin:0;font-family: ui-rounded,"SF Pro Rounded",-apple-system,system-ui,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial,sans-serif;color:var(--ink);
      background: radial-gradient(120% 120% at 0% 0%, var(--bg1), var(--bg2)); background-attachment:fixed; -webkit-tap-highlight-color: transparent;}
    .app{min-height:100dvh;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 14px;background:color-mix(in oklab,#fff 70%,transparent);backdrop-filter: blur(6px);border-bottom:1px dashed rgba(0,0,0,.08)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:44px;height:44px;border-radius:14px;background:var(--paper);display:grid;place-items:center;font-weight:900;color:var(--accent);box-shadow:inset 0 0 0 2px rgba(0,0,0,.06)}
    .title{font-weight:900;color:var(--accent)}
    .hud{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .chip{background:var(--paper);padding:6px 10px;border-radius:999px;font-weight:900;box-shadow:var(--shadow)}
    .home-link{ text-decoration:none;background:#fff;color:var(--accent);font-weight:900;border-radius:999px;padding:6px 12px;box-shadow:inset 0 0 0 2px var(--accent);transition:background .1s }
    .home-link:hover{background:var(--paper)}
    main{flex:1;padding:14px;display:flex}
    .card{margin:auto;width:min(1000px,100%);background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:18px;box-shadow:var(--shadow);padding:16px 14px}
    .section{display:flex;flex-direction:column;gap:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{background:var(--accent);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:900;box-shadow:0 6px 0 var(--accent-d)}
    .btn:active{transform:translateY(2px);box-shadow:0 4px 0 var(--accent-d)}
    .ghost{background:#fff;color:var(--accent);box-shadow: inset 0 0 0 2px var(--accent)}
    .pill{background:#fff;border:1px solid rgba(0,0,0,.08);padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800}
    .title2{font-weight:900;color:#5f430e}
    .qtext{display:flex;align-items:center;gap:10px;font-size:1.6rem;font-weight:900;line-height:1.6;word-break:keep-all}
    .starbtn{border:0;background:transparent;font-size:1.4rem;cursor:pointer}
    .star-on{color:#f4b400;filter:drop-shadow(0 1px 0 rgba(0,0,0,.2))}
    .choices{display:grid;grid-template-columns:1fr;gap:10px}
    .choice{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px 12px;font-size:1.1rem;font-weight:800;box-shadow:var(--shadow)}
    .choice:active{transform:scale(.99)}
    .key{min-width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:var(--paper);color:var(--accent);border:1px solid rgba(0,0,0,.06)}
    .result{margin-top:10px;padding:10px;border-radius:12px;border:2px dashed rgba(0,0,0,.12);display:none}
    .result.ok{border-color: color-mix(in oklab, var(--ok) 40%, transparent)}
    .result.bad{border-color: color-mix(in oklab, var(--bad) 40%, transparent)}
    footer{position:sticky;bottom:0;z-index:10;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px;background:color-mix(in oklab,#fff 70%,transparent);backdrop-filter: blur(6px);border-top:1px dashed rgba(0,0,0,.08)}
    .meter{flex:1;display:flex;gap:10px;align-items:center}
    .progress{height:12px;background:#fff;border:1px solid rgba(0,0,0,.1);border-radius:999px;overflow:hidden;flex:1}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#d9983d,#f7c66d)}
    .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:8px}
    .item{background:var(--paper);padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .hint{opacity:.85;font-size:.95rem}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">å˜</div>
        <div class="title">å¤§å®¶çš„æ—¥æœ¬èª N5ï½œL1â€“L4 å–®å­—å°è€ƒï¼ˆå›ºå®šé¡Œåº«ï¼‰</div>
      </div>
      <div class="hud">
        <div class="chip">åˆ†æ•¸ <span id="score">0</span></div>
        <div class="chip">é€£å° <span id="streak">0</span></div>
        <div class="chip" id="timeChip" style="display:none">â± <span id="timeLeft">60</span>s</div>
        <a href="index.html" class="home-link">ğŸ  å›é¦–é </a>
      </div>
    </header>

    <main>
      <section class="card section" id="setup">
        <div class="title2">æ¨¡å¼</div>
        <div class="grid">
          <label class="row"><input type="radio" name="mode" value="jp2zh" checked> <span class="pill">çœ‹åˆ°æ—¥æ–‡ â†’ é¸ä¸­æ–‡</span></label>
          <label class="row"><input type="radio" name="mode" value="zh2jp"> <span class="pill">çœ‹åˆ°ä¸­æ–‡ â†’ é¸æ—¥æ–‡</span></label>
          <label class="row"><input type="radio" name="mode" value="kanji2kana"> <span class="pill">è®€éŸ³æ¨¡å¼ï¼šæ¼¢å­— â†’ å‡å</span></label>
        </div>

        <div class="title2">ç¯„åœ</div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="useL1" checked> L1</label>
          <label class="pill"><input type="checkbox" id="useL2" checked> L2</label>
          <label class="pill"><input type="checkbox" id="useL3" checked> L3</label>
          <label class="pill"><input type="checkbox" id="useL4" checked> L4</label>
        </div>

        <div class="title2">æ¨™ç±¤ç¯©é¸</div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="tagSuffix"> æ¥å°¾è©</label>
          <label class="pill"><input type="checkbox" id="tagCountry"> åœ‹å®¶</label>
          <label class="pill"><input type="checkbox" id="tagTime"> æ™‚é–“é¡</label>
          <span class="pill"><input type="checkbox" id="onlyStar"> åªå‡º â­ï¸ æ˜Ÿè™Ÿå–®å­—</span>
        </div>

        <div class="title2">é¡Œæ•¸ & é™æ™‚</div>
        <div class="row">
          <button class="pill" data-q="10">10 é¡Œ</button>
          <button class="pill" data-q="20">20 é¡Œ</button>
          <span id="qcount" class="pill">ç›®å‰ï¼š10 é¡Œ</span>
        </div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="timed"> é™æ™‚æ¨¡å¼ï¼ˆ60 ç§’ï¼Œé€£å° +3 ç§’ï¼‰</label>
          <label class="pill"><input type="checkbox" id="byLesson"> ä¾èª²æ¬¡é †åºï¼ˆé—œé–‰ï¼éš¨æ©Ÿæ··åˆï¼‰</label>
        </div>

        <details>
          <summary>é¡Œåº«ä¸€è¦½ï¼ˆå¯ç›´æ¥åŠ æ˜Ÿï¼‰</summary>
          <div class="title2" style="margin-top:6px">L1</div>
          <div class="list" id="bankL1"></div>
          <div class="title2" style="margin-top:10px">L2</div>
          <div class="list" id="bankL2"></div>
          <div class="title2" style="margin-top:10px">L3</div>
          <div class="list" id="bankL3"></div>
          <div class="title2" style="margin-top:10px">L4</div>
          <div class="list" id="bankL4"></div>
        </details>

        <div class="row"><button class="btn" id="startBtn">é–‹å§‹æ¸¬é©— â–¶</button></div>
      </section>

      <section class="card section" id="quiz" style="display:none">
        <div class="row"><span class="pill" id="meta">ç¬¬ 1 / 10 é¡Œ</span><span class="pill" id="modeTag">JPâ†’ZH</span></div>
        <div class="qtext" id="qtext">å•é¡Œ</div>
        <div class="choices" id="choices"></div>
        <div class="result" id="resultBox">
          <div id="resHead" style="font-weight:900;margin-bottom:4px"></div>
          <div id="resBody"></div>
        </div>
        <div class="row">
          <button class="btn" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ â†’</button>
          <button class="ghost" id="speakBtn">æœ—è®€</button>
        </div>
      </section>

      <section class="card section" id="summary" style="display:none">
        <div class="title2">å®Œæˆï¼</div>
        <div>åˆ†æ•¸ï¼š<b id="finalScore">0</b> ï¼ é¡Œæ•¸ï¼š<b id="finalTotal">0</b></div>
        <div>æœ€ä½³é€£å°ï¼š<b id="finalStreak">0</b></div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="retryWrong" disabled>éŒ¯é¡Œé‡ç·´ â–¶</button>
          <button class="ghost" id="restart">å›åˆ°è¨­å®šé </button>
        </div>
      </section>
    </main>

    <footer>
      <div class="meter">
        <span class="pill">é€²åº¦</span>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>
    </footer>
  </div>

  <script>
    const T = { SUFFIX:"æ¥å°¾è©", COUNTRY:"åœ‹å®¶", TIME:"æ™‚é–“" };
    function parseKanjiKanaFlexible(jp){
      let m = jp.match(/^(.*)ï¼ˆ(.*)ï¼‰$/);
      if(m){ return {kana:m[1], kanji:m[2]} }
      m = jp.match(/^(.*)\((.*)\)$/);
      if(m){ return {kana:m[1], kanji:m[2]} }
      return {kana:jp, kanji:jp};
    }

    // === é¡Œåº«ï¼ˆå®Œå…¨ç…§ä½ çš„ç¬¬ä¸€ä»½ï¼Œæœªæ”¹ä»»ä½•å­—è©ï¼‰===
    const L1_RAW = [
      ["ã‚ãŸã—","æˆ‘",[]],["ã‚ãªãŸ","ä½ ã€æ‚¨",[]],["ã‚ã®ã²ã¨ï¼ˆã‚ã®äººï¼‰","ä»–ã€å¥¹ã€é‚£å€‹äºº",[]],["ã‚ã®ã‹ãŸï¼ˆã‚ã®æ–¹ï¼‰","ã€Œã‚ã®äººã€çš„ç¦®è²Œèªªæ³•",[]],
      ["ã€œã•ã‚“","ã€œå…ˆç”Ÿã€ã€œå°å§ã€ã€œå¥³å£«ï¼ˆæ¥å°¾ï¼‰",[T.SUFFIX]],["ã€œã¡ã‚ƒã‚“","ä»£æ›¿ã€Œã€œã•ã‚“ã€ï¼Œæ¥åœ¨å°å­©å­åå­—å¾Œï¼ˆæ¥å°¾ï¼‰",[T.SUFFIX]],["ã€œã˜ã‚“","ã€œäººï¼ˆè¡¨ç¤ºåœ‹ç±çš„æ¥å°¾è©ï¼‰",[T.SUFFIX]],
      ["ã›ã‚“ã›ã„ï¼ˆå…ˆç”Ÿï¼‰","è€å¸«",[]],["ãã‚‡ã†ã—ï¼ˆæ•™å¸«ï¼‰","æ•™å¸«",[]],["ãŒãã›ã„ï¼ˆå­¦ç”Ÿï¼‰","å­¸ç”Ÿ",[]],["ã‹ã„ã—ã‚ƒã„ã‚“ï¼ˆä¼šç¤¾å“¡ï¼‰","å…¬å¸è·å“¡",[]],["ã—ã‚ƒã„ã‚“ï¼ˆç¤¾å“¡ï¼‰","å…¬å¸è·å“¡",[]],
      ["ãã‚“ã“ã†ã„ã‚“ï¼ˆéŠ€è¡Œå“¡ï¼‰","éŠ€è¡Œè¡Œå“¡",[]],["ã„ã—ã‚ƒï¼ˆåŒ»è€…ï¼‰","é†«ç”Ÿ",[]],["ã‘ã‚“ãã‚…ã†ã—ã‚ƒï¼ˆç ”ç©¶è€…ï¼‰","ç ”ç©¶äººå“¡",[]],["ã ã„ãŒãï¼ˆå¤§å­¦ï¼‰","å¤§å­¸",[]],["ã³ã‚‡ã†ã„ã‚“ï¼ˆç—…é™¢ï¼‰","é†«é™¢",[]],
      ["ã ã‚Œï¼ˆèª°ï¼‰","èª°ï¼ˆå“ªä½ï¼‰",[]],["ã©ãªãŸ","ã€Œã ã‚Œã€çš„ç¦®è²Œèªªæ³•",[]],["ã€œã•ã„ï¼ˆã€œæ­³ï¼‰","ã€œæ­²",[]],["ãªã‚“ã•ã„ï¼ˆä½•æ­³ï¼‰","å¹¾æ­²",[]],["ãŠã„ãã¤","ã€Œãªã‚“ã•ã„ã€çš„ç¦®è²Œèªªæ³•",[]],
      ["ã¯ã„","æ˜¯ã€å°",[]],["ã„ã„ãˆ","ä¸ã€ä¸æ˜¯",[]],["ã¯ã˜ã‚ã¾ã—ã¦ã€‚","åˆæ¬¡è¦‹é¢ã€‚",[]],["ã€œã‹ã‚‰ãã¾ã—ãŸã€‚","å¾ã€œä¾†çš„ã€‚",[]],["ã©ã†ãã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™ã€‚","è«‹å¤šé—œç…§ï¼è«‹å¤šæŒ‡æ•™ã€‚",[]],
      ["ã—ã¤ã‚Œã„ã§ã™ãŒï¼ˆå¤±ç¤¼ã§ã™ãŒï¼‰","æŠ±æ­‰ï¼Œè«‹å•â€¦",[]],["ãŠãªã¾ãˆã¯ï¼Ÿï¼ˆãŠåå‰ã¯ï¼Ÿï¼‰","æ‚¨è²´å§“ï¼Ÿæ‚¨å«ä»€éº¼åå­—ï¼Ÿ",[]],["ã“ã¡ã‚‰ã¯ã€œã•ã‚“ã§ã™ã€‚","é€™ä½æ˜¯ã€œã€‚",[]],
      ["ã‚¢ãƒ¡ãƒªã‚«","ç¾åœ‹",[T.COUNTRY]],["ã‚¤ã‚®ãƒªã‚¹","è‹±åœ‹",[T.COUNTRY]],["ã‚¤ãƒ³ãƒ‰","å°åº¦",[T.COUNTRY]],["ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢","å°å°¼",[T.COUNTRY]],["ã‹ã‚“ã“ãï¼ˆéŸ“å›½ï¼‰","éŸ“åœ‹",[T.COUNTRY]],
      ["ã‚¿ã‚¤","æ³°åœ‹",[T.COUNTRY]],["ã¡ã‚…ã†ã”ãï¼ˆä¸­å›½ï¼‰","ä¸­åœ‹",[T.COUNTRY]],["ãƒ‰ã‚¤ãƒ„","å¾·åœ‹",[T.COUNTRY]],["ã«ã»ã‚“ï¼ˆæ—¥æœ¬ï¼‰","æ—¥æœ¬",[T.COUNTRY]],["ãƒ–ãƒ©ã‚¸ãƒ«","å·´è¥¿",[T.COUNTRY]]
    ];
    const L2_RAW = [
      ["ã“ã‚Œ","é€™(é›¢èªªè©±è€…è¿‘çš„æ±è¥¿)",[]],["ãã‚Œ","é‚£(é›¢è½è€…è¿‘çš„æ±è¥¿)",[]],["ã‚ã‚Œ","é‚£(é›¢èªªè©±è€…ã€è½è€…éƒ½é çš„æ±è¥¿)",[]],["ã“ã®ã€œ","é€™å€‹~",[]],["ãã®ã€œ","é‚£å€‹~ï¼ˆè¿‘å°æ–¹ï¼‰",[]],["ã‚ã®ã€œ","é‚£å€‹~ï¼ˆé ï¼‰",[]],
      ["ã»ã‚“ï¼ˆæœ¬ï¼‰","æ›¸",[]],["ã˜ã—ã‚‡ï¼ˆè¾æ›¸ï¼‰","å­—å…¸",[]],["ã–ã£ã—ï¼ˆé›‘èªŒï¼‰","é›œèªŒ",[]],["ã—ã‚“ã¶ã‚“ï¼ˆæ–°èï¼‰","å ±ç´™",[]],["ãƒãƒ¼ãƒˆ","ç­†è¨˜æœ¬",[]],["ã¦ã¡ã‚‡ã†ï¼ˆæ‰‹å¸³ï¼‰","è¨˜äº‹æœ¬",[]],["ã‚ã„ã—ï¼ˆååˆºï¼‰","åç‰‡",[]],
      ["ã‚«ãƒ¼ãƒ‰","å¡ç‰‡",[]],["ãˆã‚“ã´ã¤ï¼ˆé‰›ç­†ï¼‰","é‰›ç­†",[]],["ãƒœãƒ¼ãƒ«ãƒšãƒ³","åŸå­ç­†",[]],["ã‚·ãƒ£ãƒ¼ãƒ—ãƒšãƒ³ã‚·ãƒ«","è‡ªå‹•é‰›ç­†",[]],["ã‹ã","é‘°åŒ™",[]],["ã¨ã‘ã„ï¼ˆæ™‚è¨ˆï¼‰","é˜éŒ¶",[]],["ã‹ã•ï¼ˆå‚˜ï¼‰","å‚˜",[]],
      ["ã‹ã°ã‚“","çš®åŒ…ã€æåŒ…",[]],["ã‚·ãƒ¼ãƒ‡ã‚£ãƒ¼ï¼ˆCDï¼‰","CDã€å…‰ç¢Ÿ",[]],["ãƒ†ãƒ¬ãƒ“","é›»è¦–",[]],["ãƒ©ã‚¸ã‚ª","æ”¶éŸ³æ©Ÿ",[]],["ã‚«ãƒ¡ãƒ©","ç…§ç›¸æ©Ÿ",[]],["ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼","é›»è…¦",[]],["ãã‚‹ã¾ï¼ˆè»Šï¼‰","æ±½è»Š",[]],
      ["ã¤ããˆï¼ˆæœºï¼‰","æ¡Œå­",[]],["ã„ã™","æ¤…å­",[]],["ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ","å·§å…‹åŠ›",[]],["ã‚³ãƒ¼ãƒ’ãƒ¼","å’–å•¡",[]],["[ãŠ]ã¿ã‚„ã’","ä¼´æ‰‹ç¦®ã€åœŸç”¢",[]],["ãˆã„ã”ï¼ˆè‹±èªï¼‰","è‹±èª",[]],
      ["ã«ã»ã‚“ã”ï¼ˆæ—¥æœ¬èªï¼‰","æ—¥èª",[]],["ã€œã”ï¼ˆã€œèªï¼‰","ã€œèª",[]],["ãªã‚“ï¼ˆä½•ï¼‰","ä»€éº¼",[]],["ãã†ã§ã™","æ˜¯çš„",[]],["ã“ã‚Œã‹ã‚‰ãŠä¸–è©±ã«ãªã‚Šã¾ã™ã€‚","ä»Šå¾Œå°‡æ‰¿è’™æ‚¨çš„ç…§é¡§ã€‚",[]],
      ["ã“ã¡ã‚‰ã“ã[ã©ã†ã]ã‚ˆã‚ã—ã[ãŠé¡˜ã„ã—ã¾ã™]ã€‚","å“ªè£¡å“ªè£¡ï¼Œä¹Ÿè«‹æ‚¨å¤šå¤šæŒ‡æ•™ã€‚",[]],["ã‚ã®ã†","é‚£å€‹â‹¯ï¼ˆå®¢æ°£ã€èºŠèº‡åœ°æ­è©±ï¼‰",[]],["ãˆã£ã€‚","å’¦â‹¯ï¼ˆè½åˆ°æ„å¤–æ¶ˆæ¯æ™‚ï¼‰",[]],["ã©ã†ãã€‚","è«‹ã€‚ï¼ˆå‹¸å°æ–¹åšæŸäº‹ï¼‰",[]],
      ["[ã©ã†ã‚‚]ã‚ã‚ŠãŒã¨ã†[ã”ã–ã„ã¾ã™]ã€‚","è¬è¬ã€‚",[]],["ãã†ã§ã™ã‹ã€‚","é€™æ¨£å•Š",[]],["ã¡ãŒã„ã¾ã™ï¼ˆé•ã„ã¾ã™ï¼‰ã€‚","ä¸æ˜¯ã€‚",[]],["ã‚","å•Šï¼ˆæ„è­˜åˆ°ä»€éº¼æ™‚ï¼‰",[]]
    ];
    const L3_RAW = [
      ["ã“ã“","é€™è£¡(é›¢èªªè©±äººè¿‘çš„å ´æ‰€)",[]],["ãã“","é‚£è£¡(é›¢è½è©±äººè¿‘çš„å ´æ‰€)",[]],["ã‚ãã“","é‚£è£¡(é›¢èªªè©±äººã€è½è©±äººéƒ½é çš„å ´æ‰€)",[]],["ã©ã“","å“ªè£¡",[]],
      ["ã“ã¡ã‚‰","é€™é‚Š(ã€Œã“ã“ã€çš„ç¦®è²Œç”¨èª)",[]],["ãã¡ã‚‰","é‚£é‚Š(ã€Œãã“ã€çš„ç¦®è²Œç”¨èª)",[]],["ã‚ã¡ã‚‰","é‚£é‚Š(ã€Œã‚ãã“ã€çš„ç¦®è²Œç”¨èª)",[]],["ã©ã¡ã‚‰","å“ªé‚Šã€Œã©ã“ã€çš„ç¦®è²Œç”¨èª)",[]],
      ["ãã‚‡ã†ã—ã¤ï¼ˆæ•™å®¤ï¼‰","æ•™å®¤",[]],["ã—ã‚‡ãã©ã†ï¼ˆé£Ÿå ‚ï¼‰","é£Ÿå ‚ã€é¤å»³",[]],["ã˜ã‚€ã—ã‚‡ï¼ˆäº‹å‹™æ‰€ï¼‰","è¾¦äº‹è™•ã€äº‹å‹™æ‰€",[]],["ã‹ã„ãã—ã¤ï¼ˆä¼šè­°å®¤ï¼‰","æœƒè­°å®¤",[]],["ã†ã‘ã¤ã‘ï¼ˆå—ä»˜ï¼‰","æ¥å¾…è™•ã€æœå‹™å°",[]],
      ["ãƒ­ãƒ“ãƒ¼","å¤§å»³ã€ä¼‘æ¯å®¤",[]],["ã¸ã‚„ï¼ˆéƒ¨å±‹ï¼‰","æˆ¿é–“",[]],["ãƒˆã‚¤ãƒ¬(ãŠã¦ã‚ã‚‰ã„)ï¼ˆ(ãŠæ‰‹æ´—ã„)ï¼‰","å»æ‰€(æ´—æ‰‹é–“)",[]],["ã‹ã„ã ã‚“ï¼ˆéšæ®µï¼‰","æ¨“æ¢¯",[]],["ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼","é›»æ¢¯",[]],
      ["ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚¿ãƒ¼","é›»æ‰¶æ¢¯",[]],["ã˜ã©ã†ã¯ã‚“ã°ã„ãï¼ˆè‡ªå‹•è²©å£²æ©Ÿï¼‰","è‡ªå‹•è²©è³£æ©Ÿ",[]],["ã§ã‚“ã‚ï¼ˆé›»è©±ï¼‰","é›»è©±",[]],["[ãŠ]ãã«ï¼ˆ[ãŠ]å›½ï¼‰","åœ‹å®¶ã€æ•…é„‰",[T.COUNTRY]],["ã‹ã„ã—ã‚ƒï¼ˆä¼šç¤¾ï¼‰","å…¬å¸",[]],
      ["ã†ã¡","å®¶",[]],["ãã¤ï¼ˆé´ï¼‰","é‹å­",[]],["ãƒã‚¯ã‚¿ã‚¤","é ˜å¸¶",[]],["ãƒ¯ã‚¤ãƒ³","è‘¡è„é…’",[]],["ã†ã‚Šã°ï¼ˆå£²ã‚Šå ´ï¼‰","è³£å ´ã€å°ˆæ«ƒ",[]],["ã¡ã‹ï¼ˆåœ°ä¸‹ï¼‰","åœ°ä¸‹",[]],
      ["â‹¯ã‹ã„/ãŒã„ï¼ˆâ‹¯éšï¼‰","...æ¨“",[]],["ãªã‚“ãŒã„ï¼ˆä½•éšï¼‰","å¹¾æ¨“",[]],["â‹¯ãˆã‚“ï¼ˆâ‹¯å††ï¼‰","...æ—¥åœ“",[]],["ã„ãã‚‰","å¤šå°‘éŒ¢",[]],["ã²ã‚ƒãï¼ˆç™¾ï¼‰","ç™¾",[]],["ã›ã‚“ï¼ˆåƒï¼‰","åƒ",[]],["ã¾ã‚“ï¼ˆä¸‡ï¼‰","è¬",[]],
      ["ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚","æ­¡è¿å…‰è‡¨ï¼ˆæ‹›å‘¼å®¢äººï¼‰",[]],["[ã€œã‚’]ã¿ã›ã¦ãã ã•ã„ã€‚ ï¼ˆ[ã€œã‚’]è¦‹ã›ã¦ãã ã•ã„ã€‚ï¼‰","è«‹è®“æˆ‘çœ‹ä¸€ä¸‹ï¼ˆã€œï¼‰ã€‚",[]],["ã˜ã‚ƒ","é‚£éº¼",[]],
      ["ã€Œã€œã‚’]ãã ã•ã„ã€‚","è«‹çµ¦æˆ‘ï¼ˆã€œï¼‰ã€‚",[]],["ã™ã¿ã¾ã›ã‚“ã€‚","å°ä¸èµ·ï¼æŠ±æ­‰ã€‚",[]],["ã©ã†ã‚‚ã€‚","è¬è¬ã€‚",[]],["ã‚¤ã‚¿ãƒªã‚¢","ç¾©å¤§åˆ©",[T.COUNTRY]],["ã‚¹ã‚¤ã‚¹","ç‘å£«",[T.COUNTRY]],
      ["ãƒ•ãƒ©ãƒ³ã‚¹","æ³•åœ‹",[T.COUNTRY]],["ã‚¸ãƒ£ã‚«ãƒ«ã‚¿","é›…åŠ é”",[]],["ãƒãƒ³ã‚³ã‚¯","æ›¼è°·",[]],["ãƒ™ãƒ«ãƒªãƒ³","æŸæ—",[]],["ã—ã‚“ãŠãŠã•ã‹ï¼ˆæ–°å¤§é˜ªï¼‰","æ–°å¤§é˜ªï¼ˆå¤§é˜ªçš„è»Šç«™åï¼‰",[]]
    ];
    const L4_RAW = [
      ["ãŠãã¾ã™ï¼ˆèµ·ãã¾ã™ï¼‰","èµ·åºŠ",[]],["ã­ã¾ã™ï¼ˆå¯ã¾ã™ï¼‰","ç¡è¦º",[]],["ã¯ãŸã‚‰ãã¾ã™ï¼ˆåƒãã¾ã™ï¼‰","å·¥ä½œ",[]],["ã‚„ã™ã¿ã¾ã™ï¼ˆä¼‘ã¿ã¾ã™ï¼‰","ä¼‘æ¯",[]],
      ["ã¹ã‚“ãã‚‡ã†ã—ã¾ã™ï¼ˆå‹‰å¼·ã—ã¾ã™ï¼‰","å¿µæ›¸",[]],["ãŠã‚ã‚Šã¾ã™ï¼ˆçµ‚ã‚ã‚Šã¾ã™ï¼‰","çµæŸ",[]],
      ["ãƒ‡ãƒ‘ãƒ¼ãƒˆ","ç™¾è²¨å…¬å¸",[]],["ãã‚“ã“ã†ï¼ˆéŠ€è¡Œï¼‰","éŠ€è¡Œ",[]],["ã‚†ã†ã³ã‚“ãã‚‡ãï¼ˆéƒµä¾¿å±€ï¼‰","éƒµå±€",[]],["ã¨ã—ã‚‡ã‹ã‚“ï¼ˆå›³æ›¸é¤¨ï¼‰","åœ–æ›¸é¤¨",[]],["ã³ã˜ã‚…ã¤ã‹ã‚“ï¼ˆç¾è¡“é¤¨ï¼‰","ç¾è¡“é¤¨",[]],
      ["ã„ã¾ï¼ˆä»Šï¼‰","ç¾åœ¨",[T.TIME]],["â‹¯ã˜ï¼ˆâ€¦æ™‚ï¼‰","...é»",[T.TIME]],["â‹¯ãµã‚“ï¼ˆâ‹¯ã·ã‚“ï¼‰ï¼ˆâ€¦åˆ†ï¼‰","...åˆ†",[T.TIME]],["ã¯ã‚“ï¼ˆåŠï¼‰","åŠ",[T.TIME]],["ãªã‚“ã˜ï¼ˆä½•æ™‚ï¼‰","å¹¾é»",[T.TIME]],["ãªã‚“ã·ã‚“ï¼ˆä½•åˆ†ï¼‰","å¹¾åˆ†",[T.TIME]],
      ["ã”ãœã‚“ï¼ˆåˆå‰ï¼‰","ä¸Šåˆ",[T.TIME]],["ã”ã”ï¼ˆåˆå¾Œï¼‰","ä¸‹åˆ",[T.TIME]],["ã‚ã•ï¼ˆæœï¼‰","æ—©ä¸Š",[T.TIME]],["ã²ã‚‹ï¼ˆæ˜¼ï¼‰","ç™½å¤©",[T.TIME]],["ã°ã‚“ï¼ˆæ™©ï¼‰","æ™šä¸Š",[T.TIME]],["ã‚ˆã‚‹ï¼ˆå¤œï¼‰","æ™šä¸Š",[T.TIME]],
      ["ãŠã¨ã¨ã„","å‰å¤©",[T.TIME]],["ãã®ã†","æ˜¨å¤©",[T.TIME]],["ãã‚‡ã†","ä»Šå¤©",[T.TIME]],["ã‚ã—ãŸ","æ˜å¤©",[T.TIME]],["ã‚ã•ã£ã¦","å¾Œå¤©",[T.TIME]],
      ["ã‘ã•","ä»Šå¤©æ—©ä¸Š",[T.TIME]],["ã“ã‚“ã°ã‚“ï¼ˆä»Šæ™©ï¼‰","ä»Šæ™š",[T.TIME]],["ã‚„ã™ã¿ï¼ˆä¼‘ã¿ï¼‰","ä¼‘æ¯ã€ä¼‘å‡",[]],
      ["ã²ã‚‹ã‚„ã™ã¿ï¼ˆæ˜¼ä¼‘ã¿ï¼‰","åˆä¼‘",[T.TIME]],["ã—ã‘ã‚“ï¼ˆè©¦é¨“ï¼‰","è€ƒè©¦",[]],["ã‹ã„ãï¼ˆä¼šè­°ï¼‰","æœƒè­°",[]],["ãˆã„ãŒï¼ˆæ˜ ç”»ï¼‰","é›»å½±",[]],
      ["ã¾ã„ã‚ã•ï¼ˆæ¯æœï¼‰","æ¯å¤©æ—©ä¸Š",[T.TIME]],["ã¾ã„ã°ã‚“ï¼ˆæ¯æ™©ï¼‰","æ¯å¤©æ™šä¸Š",[T.TIME]],["ã¾ã„ã«ã¡ï¼ˆæ¯æ—¥ï¼‰","æ¯å¤©",[T.TIME]],
      ["ã’ã¤ã‚ˆã†ã³ï¼ˆæœˆæ›œæ—¥ï¼‰","æ˜ŸæœŸä¸€",[T.TIME]],["ã‹ã‚ˆã†ã³ï¼ˆç«æ›œæ—¥ï¼‰","æ˜ŸæœŸäºŒ",[T.TIME]],["ã™ã„ã‚ˆã†ã³ï¼ˆæ°´æ›œæ—¥ï¼‰","æ˜ŸæœŸä¸‰",[T.TIME]],["ã‚‚ãã‚ˆã†ã³ï¼ˆæœ¨æ›œæ—¥ï¼‰","æ˜ŸæœŸå››",[T.TIME]],
      ["ãã‚“ã‚ˆã†ã³ï¼ˆé‡‘æ›œæ—¥ï¼‰","æ˜ŸæœŸäº”",[T.TIME]],["ã©ã‚ˆã†ã³ï¼ˆåœŸæ›œæ—¥ï¼‰","æ˜ŸæœŸå…­",[T.TIME]],["ã«ã¡ã‚ˆã†ã³ï¼ˆæ—¥æ›œæ—¥ï¼‰","æ˜ŸæœŸå¤©",[T.TIME]],["ãªã‚“ã‚ˆã†ã³ï¼ˆä½•æ›œæ—¥ï¼‰","æ˜ŸæœŸå¹¾",[T.TIME]],
      ["ã€œã‹ã‚‰","å¾ã€œ",[T.TIME]],["ã€œã¾ã§","åˆ°ã€œ",[T.TIME]],["ã€œã¨ã€œ","ã€œå’Œã€œ",[]],
      ["ã°ã‚“ã”ã†ï¼ˆç•ªå·ï¼‰","è™Ÿç¢¼",[]],["ãªã‚“ã°ã‚“ï¼ˆä½•ç•ªï¼‰","å¹¾è™Ÿ",[]],["ãã¡ã‚‰","é‚£é‚Šã€æ‚¨é‚£é‚Š",[]],["ãŸã„ã¸ã‚“ã§ã™ã­ã€‚ï¼ˆå¤§å¤‰ã§ã™ã­ã€‚ï¼‰","çœŸæ˜¯è¾›è‹¦å•Šã€‚",[]],
      ["ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯","ç´ç´„",[T.COUNTRY]],["ãƒšã‚­ãƒ³","åŒ—äº¬",[T.COUNTRY]],["ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹","æ´›æ‰ç£¯",[T.COUNTRY]],["ãƒ­ãƒ³ãƒ‰ãƒ³","å€«æ•¦",[T.COUNTRY]]
    ];

    function toObj([jp, zh, tags], l){
      const {kana, kanji} = parseKanjiKanaFlexible(jp);
      const normalizedTags = (tags||[]);
      return {id:jp, jp, zh, kana, kanji, l, tags: normalizedTags};
    }
    const L1 = L1_RAW.map(x=>toObj(x,"L1"));
    const L2 = L2_RAW.map(x=>toObj(x,"L2"));
    const L3 = L3_RAW.map(x=>toObj(x,"L3"));
    const L4 = L4_RAW.map(x=>toObj(x,"L4"));
    const ALL = [...L1, ...L2, ...L3, ...L4];

    // ========= State =========
    let mode = "jp2zh";
    let fullPool = [];
    let qList = []; // æœ¬å›åˆé¡Œç›®ï¼ˆä¸é‡è¤‡ï¼‰
    let totalQ = 10;
    let qIndex = 0;
    let score = 0;
    let streak = 0, bestStreak = 0;
    let timed = false;
    let timeLeft = 60;
    let timerId = null;
    let wrongSet = [];
    let starSet = new Set(JSON.parse(localStorage.getItem("minna_L1_4_stars")||"[]"));
    let acceptingAnswer = false;

    const $ = (s, r=document)=>r.querySelector(s);
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }
    function sample(arr, n){ const a = arr.slice(); shuffle(a); return a.slice(0, n); }

    function renderBank(target, data){
      target.innerHTML = "";
      data.forEach(w=>{
        const d = document.createElement("div");
        d.className = "item";
        const jk = (w.kanji && w.kana && w.kanji!==w.kana ? `${w.kana}ï¼ˆ${w.kanji}ï¼‰` : w.jp);
        const btn = document.createElement("button");
        btn.className = "starbtn";
        btn.innerHTML = starSet.has(w.id) ? "â­ï¸" : "â˜†";
        if(starSet.has(w.id)) btn.classList.add("star-on");
        btn.onclick = ()=>{ toggleStar(w.id); btn.innerHTML = starSet.has(w.id) ? "â­ï¸" : "â˜†"; btn.classList.toggle("star-on", starSet.has(w.id)); };
        const left = document.createElement("div");
        left.innerHTML = `<div style="font-weight:900">${jk}</div><div>${w.zh}</div><div class="pill">${w.l}${w.tags.length? "ï½œ"+w.tags.join("ãƒ»"):""}</div>`;
        d.appendChild(left); d.appendChild(btn);
        target.appendChild(d);
      });
    }
    function toggleStar(id){
      if(starSet.has(id)) starSet.delete(id); else starSet.add(id);
      localStorage.setItem("minna_L1_4_stars", JSON.stringify([...starSet]));
    }
    renderBank(document.getElementById("bankL1"), L1);
    renderBank(document.getElementById("bankL2"), L2);
    renderBank(document.getElementById("bankL3"), L3);
    renderBank(document.getElementById("bankL4"), L4);

    document.querySelectorAll('[data-q]').forEach(btn=>{
      btn.addEventListener('click',()=>{ totalQ = parseInt(btn.dataset.q,10); document.getElementById("qcount").textContent = "ç›®å‰ï¼š" + totalQ + " é¡Œ"; });
    });
    document.getElementById("startBtn").addEventListener("click", startQuiz);
    document.getElementById("speakBtn").addEventListener("click", speakPrompt);
    document.getElementById("restart").addEventListener("click", ()=>{ document.getElementById("summary").style.display="none"; document.getElementById("setup").style.display="block" });
    document.getElementById("retryWrong").addEventListener("click", retryWrongOnly);

    function buildPool(){
      const use1 = document.getElementById("useL1").checked;
      const use2 = document.getElementById("useL2").checked;
      const use3 = document.getElementById("useL3").checked;
      const use4 = document.getElementById("useL4").checked;
      const wantSuffix = document.getElementById("tagSuffix").checked;
      const wantCountry = document.getElementById("tagCountry").checked;
      const wantTime = document.getElementById("tagTime").checked;
      const onlyStar = document.getElementById("onlyStar").checked;

      let p = ALL.filter(w => (w.l==="L1" && use1) || (w.l==="L2" && use2) || (w.l==="L3" && use3) || (w.l==="L4" && use4));
      if(wantSuffix || wantCountry || wantTime){
        p = p.filter(w => {
          const hasS = w.tags.includes(T.SUFFIX);
          const hasC = w.tags.includes(T.COUNTRY);
          const hasT = w.tags.includes(T.TIME);
          return (wantSuffix&&hasS) || (wantCountry&&hasC) || (wantTime&&hasT);
        });
      }
      if(onlyStar){ p = p.filter(w=> starSet.has(w.id)); }
      const byLesson = document.getElementById("byLesson").checked;
      if(byLesson){
        const order = ["L1","L2","L3","L4"];
        p.sort((a,b)=> order.indexOf(a.l) - order.indexOf(b.l));
      }else{
        shuffle(p);
      }
      return p;
    }

    function startTimer(){
      if(!timed){ return; }
      clearInterval(timerId);
      document.getElementById("timeChip").style.display = "inline-block";
      document.getElementById("timeLeft").textContent = timeLeft;
      timerId = setInterval(()=>{
        timeLeft--;
        document.getElementById("timeLeft").textContent = timeLeft;
        if(timeLeft<=0){ clearInterval(timerId); endQuiz(true); }
      }, 1000);
    }
    function addBonusSeconds(n=3){
      if(!timed) return;
      timeLeft = Math.min(timeLeft + n, 999);
      document.getElementById("timeLeft").textContent = timeLeft;
      const t = document.createElement("span"); t.textContent = `+${n}s`; t.style.marginLeft="6px"; t.style.color="var(--ok)"; t.style.fontWeight="900";
      const chip = document.getElementById("timeChip"); chip.appendChild(t); setTimeout(()=>t.remove(), 600);
    }

    function startQuiz(){
      mode = document.querySelector('input[name="mode"]:checked').value;
      fullPool = buildPool();

      if(fullPool.length < 3){
        alert("é¡Œåº«éå°ï¼šè«‹èª¿æ•´ç¯„åœæˆ–å–æ¶ˆéåº¦çš„æ¨™ç±¤/æ˜Ÿè™Ÿç¯©é¸ã€‚");
        return;
      }

      timed = document.getElementById("timed").checked;
      timeLeft = 60;
      qIndex=0; score=0; streak=0; bestStreak=0; wrongSet = [];
      document.getElementById("score").textContent = "0"; document.getElementById("streak").textContent = "0";
      document.getElementById("setup").style.display="none";
      document.getElementById("quiz").style.display="block";
      document.getElementById("summary").style.display="none";
      document.getElementById("modeTag").textContent = mode==="jp2zh"?"JPâ†’ZH":(mode==="zh2jp"?"ZHâ†’JP":"æ¼¢å­—â†’å‡å");

      // ç”Ÿæˆæœ¬å›åˆé¡Œç›®ï¼ˆä¸é‡è¤‡ï¼‰
      const byLesson = document.getElementById("byLesson").checked;
      if(byLesson){
        qList = fullPool.slice(0, Math.min(totalQ, fullPool.length));
      }else{
        qList = sample(fullPool, Math.min(totalQ, fullPool.length));
      }

      startTimer();
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("resultBox").style.display="none";
      document.getElementById("nextBtn").disabled = true;
      acceptingAnswer = true;

      if(qIndex >= qList.length){ endQuiz(); return; }
      document.getElementById("meta").textContent = `ç¬¬ ${qIndex+1} / ${qList.length} é¡Œ`;
      document.getElementById("bar").style.width = ((qIndex)/qList.length)*100 + "%";

      const q = qList[qIndex];
      const starBtnHTML = `<button class="starbtn ${starSet.has(q.id)?'star-on':''}" id="starQBtn" title="åŠ æ˜Ÿ">${starSet.has(q.id)?'â­ï¸':'â˜†'}</button>`;

      if(mode==="kanji2kana"){
        const prompt = q.kanji || q.jp;
        const distractors = sample(ALL.filter(w=> w.kana!==q.kana), 2);
        const opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = prompt + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.kana), q.kana, q);
        document.getElementById("choices").dataset.prompt = q.kana;
      } else if(mode==="jp2zh"){
        const distractors = sample(ALL.filter(w=> w.zh!==q.zh), 2);
        const opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = q.jp + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.zh), q.zh, q);
        document.getElementById("choices").dataset.prompt = q.jp;
      } else {
        const distractors = sample(ALL.filter(w=> w.jp!==q.jp), 2);
        const opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = q.zh + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.jp), q.jp, q);
        document.getElementById("choices").dataset.prompt = q.jp;
      }

      const starBtn = document.getElementById("starQBtn");
      starBtn.onclick = ()=>{ toggleStar(q.id); starBtn.textContent = starSet.has(q.id) ? "â­ï¸" : "â˜†"; starBtn.classList.toggle("star-on", starSet.has(q.id)); };

      document.getElementById("nextBtn").onclick = ()=>{ qIndex++; nextQuestion(); };
    }

    function renderChoices(texts, correctText, qobj){
      const choices = document.getElementById("choices"); choices.innerHTML="";
      texts.forEach((txt, idx)=>{
        const div = document.createElement("div");
        div.className="choice";
        div.innerHTML = `<div class="key">${"ABC"[idx]}</div><div class="text">${txt}</div>`;
        div.addEventListener("click", ()=>onChoose(div, txt, correctText, qobj));
        choices.appendChild(div);
      });
    }

    function freezeChoices(){
      document.querySelectorAll("#choices .choice").forEach(n=>{
        n.classList.add("disabled");
      });
    }

    function onChoose(node, chosenText, correctText, q){
      if(!acceptingAnswer) return;
      acceptingAnswer = false;

      const ok = (chosenText === correctText);
      const box = document.getElementById("resultBox");
      const head = document.getElementById("resHead");
      const body = document.getElementById("resBody");

      // æ¨™ç¤ºæ­£ç¢º/éŒ¯èª¤
      document.querySelectorAll("#choices .choice").forEach(n=>{
        const text = n.querySelector(".text").textContent;
        if(text === correctText){ n.classList.add("correct"); }
        if(n === node && !ok){ n.classList.add("wrong"); }
      });

      if(ok){
        score++; streak++; bestStreak = Math.max(bestStreak, streak);
        document.getElementById("score").textContent = score; document.getElementById("streak").textContent = streak;
        box.classList.remove("bad"); box.classList.add("ok");
        head.textContent = "âœ… æ­£ç¢ºï¼";
        if(timed) addBonusSeconds(3);
      }else{
        streak=0; document.getElementById("streak").textContent = streak;
        box.classList.remove("ok"); box.classList.add("bad");
        head.textContent = "âŒ ç­”éŒ¯äº†";
        wrongSet.push(q);
      }

      if(mode==="kanji2kana"){
        body.textContent = `${q.kanji} â†’ ${q.kana}ï½œ${q.zh}`;
      }else if(mode==="jp2zh"){
        body.textContent = `${q.jp} â†’ ${q.zh}`;
      }else{
        body.textContent = `${q.zh} â†’ ${q.jp}`;
      }

      box.style.display="block";
      document.getElementById("nextBtn").disabled = false;
      freezeChoices();
      document.getElementById("bar").style.width = ((qIndex+1)/qList.length)*100 + "%";
    }

    function endQuiz(timeUp=false){
      clearInterval(timerId); timerId=null;
      document.getElementById("quiz").style.display="none";
      document.getElementById("summary").style.display="block";
      document.getElementById("finalScore").textContent = score;
      document.getElementById("finalTotal").textContent = qList.length;
      document.getElementById("finalStreak").textContent = bestStreak;
      document.getElementById("bar").style.width = "100%";
      document.getElementById("timeChip").style.display = "none";
      const btn = document.getElementById("retryWrong");
      btn.disabled = wrongSet.length===0;
      if(timeUp){ alert("æ™‚é–“åˆ°ï¼çœ‹çœ‹é€™å›åˆæˆç¸¾ï½"); }
    }

    function retryWrongOnly(){
      if(wrongSet.length===0){ alert("æ²’æœ‰éŒ¯é¡Œå¯é‡ç·´ï¼"); return; }
      const map = new Map(); wrongSet.forEach(w=>map.set(w.id,w));
      fullPool = [...map.values()];
      qList = sample(fullPool, Math.min(fullPool.length, 999)); // å…¨éƒ¨éŒ¯é¡Œä¸€æ¬¡è·‘å®Œ
      timed = false;
      qIndex=0; score=0; streak=0; bestStreak=0;
      document.getElementById("score").textContent = "0";
      document.getElementById("streak").textContent = "0";
      document.getElementById("summary").style.display="none";
      document.getElementById("quiz").style.display="block";
      nextQuestion();
    }

    function speakPrompt(){
      const utter = new SpeechSynthesisUtterance(document.getElementById("choices").dataset.prompt || "");
      utter.lang = "ja-JP";
      speechSynthesis.stop();
      speechSynthesis.speak(utter);
    }

    // å¿«æ·éµ A/B/Cï¼ˆåƒ…å¯åœ¨å¯ä½œç­”éšæ®µï¼‰
    document.addEventListener("keydown", (e)=>{
      if(!acceptingAnswer) return;
      const map = { "a":0, "b":1, "c":2 };
      const idx = map[e.key?.toLowerCase()];
      if(idx!=null){
        const node = document.querySelectorAll("#choices .choice")[idx];
        if(node) node.click();
      }
    });
  </script>
</body>
</html>
