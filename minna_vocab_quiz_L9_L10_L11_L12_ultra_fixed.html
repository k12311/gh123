<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>å¤§å®¶çš„æ—¥æœ¬èª N5ï½œL9â€“L12 å–®å­—å°è€ƒï¼ˆå›ºå®šé¡Œåº«ï¼‰</title>
  <style>
    :root{ --bg1:#fff6dc; --bg2:#ffeec5; --paper:#fff7da; --ink:#1d1608; --accent:#d9983d; --accent-d:#b67a2f; --ok:#2e7d32; --bad:#c62828; --shadow:0 10px 20px rgba(0,0,0,.08); }
    html,body{height:100%}
    body{margin:0;font-family: ui-rounded,"SF Pro Rounded",-apple-system,system-ui,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial,sans-serif;color:var(--ink);
      background: radial-gradient(120% 120% at 0% 0%, var(--bg1), var(--bg2)); background-attachment:fixed; -webkit-tap-highlight-color: transparent;}
    .app{min-height:100dvh;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 14px;background:color-mix(in oklab,#fff 70%,transparent);backdrop-filter: blur(6px);border-bottom:1px dashed rgba(0,0,0,.08)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:44px;height:44px;border-radius:14px;background:var(--paper);display:grid;place-items:center;font-weight:900;color:var(--accent);box-shadow:inset 0 0 0 2px rgba(0,0,0,.06)}
    .title{font-weight:900;color:var(--accent)}
    .hud{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .chip{background:var(--paper);padding:6px 10px;border-radius:999px;font-weight:900;box-shadow:var(--shadow)}
    /* å›é¦–é æŒ‰éˆ• */
    .home-link{
      text-decoration:none;background:#fff;color:var(--accent);
      font-weight:900;border-radius:999px;padding:6px 12px;
      box-shadow:inset 0 0 0 2px var(--accent);
      transition:background .12s;
    }
    .home-link:hover{background:var(--paper)}
    main{flex:1;padding:14px;display:flex}
    .card{margin:auto;width:min(1000px,100%);background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:18px;box-shadow:var(--shadow);padding:16px 14px}
    .section{display:flex;flex-direction:column;gap:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{background:var(--accent);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:900;box-shadow:0 6px 0 var(--accent-d)}
    .btn:active{transform:translateY(2px);box-shadow:0 4px 0 var(--accent-d)}
    .ghost{background:#fff;color:var(--accent);box-shadow: inset 0 0 0 2px var(--accent)}
    .pill{background:#fff;border:1px solid rgba(0,0,0,.08);padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800}
    .title2{font-weight:900;color:#5f430e}
    .qtext{display:flex;align-items:center;gap:10px;font-size:1.6rem;font-weight:900;line-height:1.6;word-break:keep-all}
    .starbtn{border:0;background:transparent;font-size:1.4rem;cursor:pointer}
    .star-on{color:#f4b400;filter:drop-shadow(0 1px 0 rgba(0,0,0,.2))}
    .choices{display:grid;grid-template-columns:1fr;gap:10px}
    .choice{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px 12px;font-size:1.1rem;font-weight:800;box-shadow:var(--shadow)}
    .choice:active{transform:scale(.99)}
    .key{min-width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:var(--paper);color:var(--accent);border:1px solid rgba(0,0,0,.06)}
    .result{margin-top:10px;padding:10px;border-radius:12px;border:2px dashed rgba(0,0,0,.12);display:none}
    .result.ok{border-color: color-mix(in oklab, var(--ok) 40%, transparent)}
    .result.bad{border-color: color-mix(in oklab, var(--bad) 40%, transparent)}
    footer{position:sticky;bottom:0;z-index:10;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px;background:color-mix(in oklab,#fff 70%,transparent);backdrop-filter: blur(6px);border-top:1px dashed rgba(0,0,0,.08)}
    .meter{flex:1;display:flex;gap:10px;align-items:center}
    .progress{height:12px;background:#fff;border:1px solid rgba(0,0,0,.1);border-radius:999px;overflow:hidden;flex:1}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#d9983d,#f7c66d)}
    .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:8px}
    .item{background:var(--paper);padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .hint{opacity:.85;font-size:.95rem}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">å˜</div>
        <div class="title">å¤§å®¶çš„æ—¥æœ¬èª N5ï½œL9â€“L12 å–®å­—å°è€ƒï¼ˆå›ºå®šé¡Œåº«ï¼‰</div>
      </div>
      <div class="hud">
        <div class="chip">åˆ†æ•¸ <span id="score">0</span></div>
        <div class="chip">é€£å° <span id="streak">0</span></div>
        <div class="chip" id="timeChip" style="display:none">â± <span id="timeLeft">60</span>s</div>
        <!-- å›é¦–é  -->
        <a class="home-link" href="index.html">ğŸ  å›é¦–é </a>
      </div>
    </header>

    <main>
      <section class="card section" id="setup">
        <div class="title2">æ¨¡å¼</div>
        <div class="grid">
          <label class="row"><input type="radio" name="mode" value="jp2zh" checked> <span class="pill">çœ‹åˆ°æ—¥æ–‡ â†’ é¸ä¸­æ–‡</span></label>
          <label class="row"><input type="radio" name="mode" value="zh2jp"> <span class="pill">çœ‹åˆ°ä¸­æ–‡ â†’ é¸æ—¥æ–‡</span></label>
          <label class="row"><input type="radio" name="mode" value="kanji2kana"> <span class="pill">è®€éŸ³æ¨¡å¼ï¼šæ¼¢å­— â†’ å‡å</span></label>
        </div>

        <div class="title2">ç¯„åœ</div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="useL9" checked> L9</label>
          <label class="pill"><input type="checkbox" id="useL10" checked> L10</label>
          <label class="pill"><input type="checkbox" id="useL11" checked> L11</label>
          <label class="pill"><input type="checkbox" id="useL12" checked> L12</label>
        </div>

        <div class="title2">æ¨™ç±¤ç¯©é¸</div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="tagSuffix"> æ¥å°¾è©</label>
          <label class="pill"><input type="checkbox" id="tagCountry"> åœ‹å®¶</label>
          <label class="pill"><input type="checkbox" id="tagTime"> æ™‚é–“é¡</label>
          <span class="pill"><input type="checkbox" id="onlyStar"> åªå‡º â­ï¸ æ˜Ÿè™Ÿå–®å­—</span>
        </div>

        <div class="title2">é¡Œæ•¸ & é™æ™‚</div>
        <div class="row">
          <button class="pill" data-q="10">10 é¡Œ</button>
          <button class="pill" data-q="20">20 é¡Œ</button>
          <span id="qcount" class="pill">ç›®å‰ï¼š10 é¡Œ</span>
        </div>
        <div class="row">
          <label class="pill"><input type="checkbox" id="timed"> é™æ™‚æ¨¡å¼ï¼ˆ60 ç§’ï¼Œé€£å° +3 ç§’ï¼‰</label>
          <label class="pill"><input type="checkbox" id="byLesson" checked> ä¾èª²æ¬¡é †åºï¼ˆé—œé–‰ï¼éš¨æ©Ÿæ··åˆï¼‰</label>
        </div>

        <details>
          <summary>é¡Œåº«ä¸€è¦½ï¼ˆå¯ç›´æ¥åŠ æ˜Ÿï¼‰</summary>
          <div class="title2" style="margin-top:6px">L9</div>
          <div class="list" id="bankL9"></div>
          <div class="title2" style="margin-top:10px">L10</div>
          <div class="list" id="bankL10"></div>
          <div class="title2" style="margin-top:10px">L11</div>
          <div class="list" id="bankL11"></div>
          <div class="title2" style="margin-top:10px">L12</div>
          <div class="list" id="bankL12"></div>
        </details>

        <div class="row"><button class="btn" id="startBtn">é–‹å§‹æ¸¬é©— â–¶</button></div>
      </section>

      <section class="card section" id="quiz" style="display:none">
        <div class="row"><span class="pill" id="meta">ç¬¬ 1 / 10 é¡Œ</span><span class="pill" id="modeTag">JPâ†’ZH</span></div>
        <div class="qtext" id="qtext">å•é¡Œ</div>
        <div class="choices" id="choices"></div>
        <div class="result" id="resultBox">
          <div id="resHead" style="font-weight:900;margin-bottom:4px"></div>
          <div id="resBody"></div>
        </div>
        <div class="row">
          <button class="btn" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ â†’</button>
          <button class="ghost" id="speakBtn">æœ—è®€</button>
        </div>
      </section>

      <section class="card section" id="summary" style="display:none">
        <div class="title2">å®Œæˆï¼</div>
        <div>åˆ†æ•¸ï¼š<b id="finalScore">0</b> ï¼ é¡Œæ•¸ï¼š<b id="finalTotal">0</b></div>
        <div>æœ€ä½³é€£å°ï¼š<b id="finalStreak">0</b></div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="retryWrong" disabled>éŒ¯é¡Œé‡ç·´ â–¶</button>
          <button class="ghost" id="restart">å›åˆ°è¨­å®šé </button>
        </div>
      </section>
    </main>

    <footer>
      <div class="meter">
        <span class="pill">é€²åº¦</span>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>
    </footer>
  </div>

  <script>
    const T = { SUFFIX:"æ¥å°¾è©", COUNTRY:"åœ‹å®¶", TIME:"æ™‚é–“" };
    function parseKanjiKanaFlexible(jp){
      let m = jp.match(/^(.*)ï¼ˆ(.*)ï¼‰$/);
      if(m){ return {kana:m[1], kanji:m[2]} }
      m = jp.match(/^(.*)\((.*)\)$/);
      if(m){ return {kana:m[1], kanji:m[2]} }
      return {kana:jp, kanji:jp};
    }
    function toObj(jp, zh, tags, l){
      const {kana, kanji} = parseKanjiKanaFlexible(jp.trim());
      const normTags = (tags||[]).map(t=>t.trim()).filter(Boolean);
      return {id:jp.trim()+"__"+zh.trim(), jp:jp.trim(), zh:zh.trim(), kana, kanji, tags:normTags, l};
    }

    // ---- L9
    const L9 = [
      toObj("ã‚ã‹ã‚Šã¾ã™","æ‡‚ã€æ˜ç™½",[], "L9"),
      toObj("ã‚ã‚Šã¾ã™","æœ‰",[], "L9"),
      toObj("ã™ãï¼ˆå¥½ã[ãª]ï¼‰","å–œæ­¡",[], "L9"),
      toObj("ãã‚‰ã„ï¼ˆå«Œã„[ãª]ï¼‰","ä¸å–œæ­¡",[], "L9"),
      toObj("ã˜ã‚‡ã†ãšï¼ˆä¸Šæ‰‹[ãª]ï¼‰","å¥½ã€æ“…é•·",[], "L9"),
      toObj("ã¸ãŸï¼ˆä¸‹æ‰‹[ãª]ï¼‰","ä¸å¥½ã€ä¸æ“…é•·",[], "L9"),
      toObj("ã®ã¿ã‚‚ã®ï¼ˆé£²ã¿ç‰©ï¼‰","é£²æ–™",[], "L9"),
      toObj("ã‚Šã‚‡ã†ã‚Šï¼ˆæ–™ç†ï¼‰","æ–™ç†ã€èœé¤š",[], "L9"),
      toObj("ã‚¹ãƒãƒ¼ãƒ„","é«”è‚²ã€é‹å‹•",[], "L9"),
      toObj("ã‚„ãã‚…ã†ï¼ˆé‡çƒï¼‰","æ£’çƒ",[], "L9"),
      toObj("ãƒ€ãƒ³ã‚¹","èˆ",[], "L9"),
      toObj("ã‚Šã‚‡ã“ã†ï¼ˆæ—…è¡Œï¼‰","æ—…è¡Œ",[], "L9"),
      toObj("ãŠã‚“ãŒãï¼ˆéŸ³æ¥½ï¼‰","éŸ³æ¨‚",[], "L9"),
      toObj("ã†ãŸï¼ˆæ­Œï¼‰","æ­Œ",[], "L9"),
      toObj("ã‚¯ãƒ©ã‚·ãƒƒã‚¯","å¤å…¸éŸ³æ¨‚",[], "L9"),
      toObj("ã‚¸ãƒ£ã‚º","çˆµå£«æ¨‚",[], "L9"),
      toObj("ã‚³ãƒ³ã‚µãƒ¼ãƒˆ","éŸ³æ¨‚æœƒã€æ¼”å”±æœƒ",[], "L9"),
      toObj("ã‚«ãƒ©ã‚ªã‚±","å¡æ‹‰OKã€KTV",[], "L9"),
      toObj("ã‹ã¶ãï¼ˆæ­Œèˆä¼ï¼‰","æ­Œèˆä¼ï¼ˆæ—¥æœ¬å‚³çµ±æˆ²åŠ‡ï¼‰",[], "L9"),
      toObj("ãˆï¼ˆçµµï¼‰","ç•«",[], "L9"),
      toObj("ã˜ï¼ˆå­—ï¼‰","å­—",[], "L9"),
      toObj("ã‹ã‚“ã˜ï¼ˆæ¼¢å­—ï¼‰","æ¼¢å­—",[], "L9"),
      toObj("ã²ã‚‰ãŒãª","å¹³å‡å",[], "L9"),
      toObj("ã‹ãŸã‹ãª","ç‰‡å‡å",[], "L9"),
      toObj("ãƒ­ãƒ¼ãƒã˜ï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰","ç¾…é¦¬å­—æ¯",[], "L9"),
      toObj("ã“ã¾ã‹ã„ãŠã‹ã­ï¼ˆç´°ã‹ã„ãŠé‡‘ï¼‰","é›¶éŒ¢",[], "L9"),
      toObj("ãƒã‚±ãƒƒãƒˆ","ç¥¨",[], "L9"),
      toObj("ã˜ã‹ã‚“ï¼ˆæ™‚é–“ï¼‰","æ™‚é–“",[T.TIME], "L9"),
      toObj("ã‚ˆã†ã˜ï¼ˆç”¨äº‹ï¼‰","äº‹æƒ…",[], "L9"),
      toObj("ã‚„ãããï¼ˆç´„æŸï¼‰","ç´„å®š",[], "L9"),
      toObj("ã‚¢ãƒ«ãƒã‚¤ãƒˆ","æ‰“å·¥",[], "L9"),
      toObj("ã”ã—ã‚…ã˜ã‚“ï¼ˆã”ä¸»äººï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰ä¸ˆå¤«",[], "L9"),
      toObj("ãŠã£ã¨ï¼ã—ã‚…ã˜ã‚“ï¼ˆå¤«ï¼ä¸»äººï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰ä¸ˆå¤«",[], "L9"),
      toObj("ãŠãã•ã‚“ï¼ˆå¥¥ã•ã‚“ï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰å¦»å­",[], "L9"),
      toObj("ã¤ã¾ï¼ã‹ãªã„ï¼ˆå¦»ï¼å®¶å†…ï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰å¦»å­",[], "L9"),
      toObj("ã“ã©ã‚‚ï¼ˆå­ã©ã‚‚ï¼‰","å°å­©",[], "L9"),
      toObj("ã‚ˆã","å¾ˆã€éå¸¸",[], "L9"),
      toObj("ã ã„ãŸã„","å¤§è‡´ã€å¤§æ¦‚",[], "L9"),
      toObj("ãŸãã•ã‚“","å¾ˆå¤š",[], "L9"),
      toObj("ã™ã“ã—ï¼ˆå°‘ã—ï¼‰","ä¸€äº›ã€ä¸€é»",[], "L9"),
      toObj("ãœã‚“ãœã‚“ï¼ˆå…¨ç„¶ï¼‰","å®Œå…¨ï¼ˆå¾Œæ¥å¦å®šï¼‰",[], "L9"),
      toObj("ã¯ã‚„ãï¼ˆæ—©ãã€é€Ÿãï¼‰","æ—©ã€å¿«",[], "L9"),
      toObj("ã€œã‹ã‚‰","å› ç‚ºã€œ",[], "L9"),
      toObj("ã©ã†ã—ã¦","æ€éº¼ã€ç‚ºä»€éº¼",[], "L9"),
    ];

    // ---- L10
    const L10 = [
      toObj("ã‚ã‚Šã¾ã™","åœ¨ã€æœ‰(ä¸æœƒæ´»å‹•çš„æ±è¥¿)",[], "L10"),
      toObj("ã„ã¾ã™","åœ¨ã€æœ‰(æœƒæ´»å‹•çš„äººã€å‹•ç‰©)",[], "L10"),
      toObj("ã„ã‚ã„ã‚[ãª]","å„å¼å„æ¨£",[], "L10"),
      toObj("ãŠã¨ã“ã®ã²ã¨ï¼ˆç”·ã®äººï¼‰","ç”·äºº",[], "L10"),
      toObj("ãŠã‚“ãªã®ã²ã¨ï¼ˆå¥³ã®äººï¼‰","å¥³äºº",[], "L10"),
      toObj("ãŠã¨ã“ã®ã“ï¼ˆç”·ã®å­ï¼‰","ç”·å­©",[], "L10"),
      toObj("ãŠã‚“ãªã®ã“ï¼ˆå¥³ã®å­ï¼‰","å¥³å­©",[], "L10"),
      toObj("ã„ã¬ï¼ˆçŠ¬ï¼‰","ç‹—",[], "L10"),
      toObj("ã­ã“ï¼ˆçŒ«ï¼‰","è²“",[], "L10"),
      toObj("ãƒ‘ãƒ³ãƒ€","è²“ç†Š",[], "L10"),
      toObj("ãã†ï¼ˆè±¡ï¼‰","å¤§è±¡",[], "L10"),
      toObj("ãï¼ˆæœ¨ï¼‰","æ¨¹æœ¨",[], "L10"),
      toObj("ã‚‚ã®ï¼ˆç‰©ï¼‰","æ±è¥¿",[], "L10"),
      toObj("ã§ã‚“ã¡ï¼ˆé›»æ± ï¼‰","é›»æ± ",[], "L10"),
      toObj("ã¯ã“ï¼ˆç®±ï¼‰","ç®±å­",[], "L10"),
      toObj("ã‚¹ã‚¤ãƒƒãƒ","é–‹é—œ",[], "L10"),
      toObj("ã‚Œã„ãã†ã“ï¼ˆå†·è”µåº«ï¼‰","å†°ç®±",[], "L10"),
      toObj("ãƒ†ãƒ¼ãƒ–ãƒ«","é¤æ¡Œã€æ¡Œå­",[], "L10"),
      toObj("ã¹ãƒƒãƒ‰","åºŠ",[], "L10"),
      toObj("ãŸãªï¼ˆæ£šï¼‰","æ¶å­",[], "L10"),
      toObj("ãƒ‰ã‚¢","é–€",[], "L10"),
      toObj("ã¾ã©ï¼ˆçª“ï¼‰","çª—æˆ·",[], "L10"),
      toObj("ãƒã‚¹ãƒˆ","éƒµç­’ã€ä¿¡ç®±",[], "L10"),
      toObj("ãƒ“ãƒ«","å¤§æ¨“",[], "L10"),
      toObj("ã‚¨ãƒ¼ãƒ†ã‚£ãƒ¼ã‚¨ãƒ ï¼ˆATMï¼‰","è‡ªå‹•æ«ƒå“¡æ©Ÿã€è‡ªå‹•ææ¬¾æ©Ÿ",[], "L10"),
      toObj("ã‚³ãƒ³ãƒ“ãƒ‹","ä¾¿åˆ©å•†åº—ã€è¶…å•†",[], "L10"),
      toObj("ã“ã†ãˆã‚“ï¼ˆå…¬åœ’ï¼‰","å…¬åœ’",[], "L10"),
      toObj("ãã£ã•ã¦ã‚“ï¼ˆå–«èŒ¶åº—ï¼‰","å’–å•¡åº—",[], "L10"),
      toObj("ã€œã‚„ï¼ˆã€œå±‹ï¼‰","ã€œåº—",[], "L10"),
      toObj("ã®ã‚Šã°ï¼ˆä¹—ã‚Šå ´ï¼‰","ä¹˜è»Šè™•(è¨ˆç¨‹è»Šã€é›»è»Šç­‰)",[], "L10"),
      toObj("ã‘ã‚“ï¼ˆçœŒï¼‰","ç¸£",[], "L10"),
      toObj("ã†ãˆï¼ˆä¸Šï¼‰","ä¸Š",[], "L10"),
      toObj("ã—ãŸï¼ˆä¸‹ï¼‰","ä¸‹",[], "L10"),
      toObj("ã¾ãˆï¼ˆå‰ï¼‰","å‰",[], "L10"),
      toObj("ã†ã—ã‚","å¾Œ",[], "L10"),
      toObj("ã¿ãï¼ˆå³ï¼‰","å³",[], "L10"),
      toObj("ã²ã ã‚Šï¼ˆå·¦ï¼‰","å·¦",[], "L10"),
      toObj("ãªã‹ï¼ˆä¸­ï¼‰","ä¸­é–“ã€è£¡é¢",[], "L10"),
      toObj("ãã¨ï¼ˆå¤–ï¼‰","å¤–é¢",[], "L10"),
      toObj("ã¨ãªã‚Šï¼ˆéš£ï¼‰","æ—é‚Š",[], "L10"),
      toObj("ã¡ã‹ãï¼ˆè¿‘ãï¼‰","é™„è¿‘",[], "L10"),
      toObj("ã‚ã„ã ï¼ˆé–“ï¼‰","ã€œä¹‹é–“",[], "L10"),
      toObj("ã€œã‚„ã€œ[ãªã©]","ã€œå’Œã€œ(ç­‰)",[], "L10"),
    ];

    // ---- L11
    const L11 = [
      toObj("ã„ã¾ã™[å­ã©ã‚‚ãŒã€œ]","æœ‰[å°å­©]",[], "L11"),
      toObj("ã„ã¾ã™[æ—¥æœ¬ã«ã€œ]","åœ¨[æ—¥æœ¬]",[], "L11"),
      toObj("ã‹ã‹ã‚Šã¾ã™","èŠ±è²»(æ™‚é–“ã€é‡‘éŒ¢ç­‰)",[], "L11"),
      toObj("ã‚„ã™ã¿ã¾ã™[ä¼šç¤¾ã‚’ã€œ]ï¼ˆä¼‘ã¿ã¾ã™[ä¼šç¤¾ã‚’ã€œ]ï¼‰","[å‘å…¬å¸]è«‹å‡",[], "L11"),
      toObj("ã²ã¨ã¤ï¼ˆ1 ã¤ï¼‰","ä¸€ã€ä¸€å€‹ï¼ˆæ•¸æ±è¥¿ï¼‰",[], "L11"),
      toObj("ãµãŸã¤ï¼ˆ2 ã¤ï¼‰","äºŒã€å…©å€‹",[], "L11"),
      toObj("ã¿ã£ã¤ï¼ˆ3 ã¤ï¼‰","ä¸‰ã€ä¸‰å€‹",[], "L11"),
      toObj("ã‚ˆã£ã¤ï¼ˆ4 ã¤ï¼‰","å››ã€å››å€‹",[], "L11"),
      toObj("ã„ã¤ã¤ï¼ˆ5 ã¤ï¼‰","äº”ã€äº”å€‹",[], "L11"),
      toObj("ã‚€ã£ã¤ï¼ˆ6 ã¤ï¼‰","å…­ã€å…­å€‹",[], "L11"),
      toObj("ãªãªã¤ï¼ˆ7 ã¤ï¼‰","ä¸ƒã€ä¸ƒå€‹",[], "L11"),
      toObj("ã‚„ã£ã¤ï¼ˆ8 ã¤ï¼‰","å…«ã€å…«å€‹",[], "L11"),
      toObj("ã“ã“ã®ã¤ï¼ˆ9 ã¤ï¼‰","ä¹ã€ä¹å€‹",[], "L11"),
      toObj("ã¨ãŠï¼ˆ10ï¼‰","åã€åå€‹",[], "L11"),
      toObj("ã„ãã¤","å¤šå°‘",[], "L11"),
      toObj("ã²ã¨ã‚Šï¼ˆ1 äººï¼‰","ä¸€å€‹äºº",[], "L11"),
      toObj("ãµãŸã‚Šï¼ˆ2 äººï¼‰","å…©å€‹äºº",[], "L11"),
      toObj("â€¦ã«ã‚“ï¼ˆâ€¦äººï¼‰","â€¦å€‹äººï¼â€¦å£äºº",[], "L11"),
      toObj("â€¦ã ã„","â€¦å°ï¼ˆæ•¸æ©Ÿæ¢°ã€è»Šè¼›ç­‰ï¼‰",[], "L11"),
      toObj("â€¦ã¾ã„","â€¦æšï¼â€¦å¼µï¼ˆæ•¸ç´™å¼µã€éƒµç¥¨ç­‰ï¼‰",[], "L11"),
      toObj("â€¦ã‹ã„","â€¦æ¬¡",[], "L11"),
      toObj("ã‚Šã‚“ã”","è˜‹æœ",[], "L11"),
      toObj("ã¿ã‹ã‚“","æ©˜å­",[], "L11"),
      toObj("ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ","ä¸‰æ˜æ²»",[], "L11"),
      toObj("ã‚«ãƒ¬ãƒ¼[ãƒ©ã‚¤ã‚¹]","å’–å“©[é£¯]",[], "L11"),
      toObj("ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ","å†°æ·‡æ·‹",[], "L11"),
      toObj("ãã£ã¦ï¼ˆåˆ‡æ‰‹ï¼‰","éƒµç¥¨",[], "L11"),
      toObj("ã¯ãŒã","æ˜ä¿¡ç‰‡",[], "L11"),
      toObj("ãµã†ã¨ã†ï¼ˆå°ç­’ï¼‰","ä¿¡å°",[], "L11"),
      toObj("ã‚Šã‚‡ã†ã—ã‚“ï¼ˆä¸¡è¦ªï¼‰","çˆ¶æ¯ã€é›™è¦ª",[], "L11"),
      toObj("ãã‚‡ã†ã ã„ï¼ˆå…„å¼Ÿï¼‰","å…„å¼Ÿå§Šå¦¹",[], "L11"),
      toObj("ã‚ã«ï¼ˆå…„ï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰å“¥å“¥",[], "L11"),
      toObj("ãŠã«ã„ã•ã‚“ï¼ˆãŠå…„ã•ã‚“ï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰å“¥å“¥",[], "L11"),
      toObj("ã‚ã­ï¼ˆå§‰ï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰å§Šå§Š",[], "L11"),
      toObj("ãŠã­ãˆã•ã‚“ï¼ˆãŠå§‰ã•ã‚“ï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰å§Šå§Š",[], "L11"),
      toObj("ãŠã¨ã†ã¨ï¼ˆå¼Ÿï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰å¼Ÿå¼Ÿ",[], "L11"),
      toObj("ãŠã¨ã†ã¨ã•ã‚“ï¼ˆå¼Ÿã•ã‚“ï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰å¼Ÿå¼Ÿ",[], "L11"),
      toObj("ã„ã‚‚ã†ã¨ï¼ˆå¦¹ï¼‰","ï¼ˆè‡ªå·±çš„ï¼‰å¦¹å¦¹",[], "L11"),
      toObj("ã„ã‚‚ã†ã¨ã•ã‚“ï¼ˆå¦¹ã•ã‚“ï¼‰","ï¼ˆåˆ¥äººçš„ï¼‰å¦¹å¦¹",[], "L11"),
      toObj("ãŒã„ã“ãï¼ˆå¤–å›½ï¼‰","å¤–åœ‹",[], "L11"),
      toObj("ã‚Šã‚…ã†ãŒãã›ã„ï¼ˆç•™å­¦ç”Ÿï¼‰","ç•™å­¸ç”Ÿ",[], "L11"),
      toObj("ã‚¯ãƒ©ã‚¹","ç­ç´š",[], "L11"),
      toObj("â€¦ã˜ã‹ã‚“","â€¦å°æ™‚",[T.TIME], "L11"),
      toObj("ã—ã‚…ã†ã‹ã‚“ï¼ˆâ€¦é€±é–“ï¼‰","â€¦æ˜ŸæœŸ",[T.TIME], "L11"),
      toObj("â€¦ã‹ã’ã¤ï¼ˆâ€¦ã‹æœˆï¼‰","â€¦å€‹æœˆ",[T.TIME], "L11"),
      toObj("â€¦ã­ã‚“ï¼ˆâ€¦å¹´ï¼‰","â€¦å¹´",[T.TIME], "L11"),
      toObj("ã€œãã‚‰ã„","ã€œå·¦å³ã€å¤§ç´„ã€œ",[], "L11"),
      toObj("ã©ã®ãã‚‰ã„","å¤šä¹…æ™‚é–“",[], "L11"),
      toObj("ãœã‚“ã¶ã§ï¼ˆå…¨éƒ¨ã§ï¼‰","ä¸€å…±ã€åˆè¨ˆ",[], "L11"),
      toObj("ã¿ã‚“ãª","å…¨éƒ¨ã€å¤§å®¶",[], "L11"),
      toObj("ã€œã ã‘","åªã€œ",[], "L11"),
    ];

    // ---- L12
    const L12 = [
      toObj("ã‹ã‚“ãŸã‚“[ãª]ï¼ˆç°¡å˜[ãª]ï¼‰","ç°¡å–®",[], "L12"),
      toObj("ã¡ã‹ã„ï¼ˆè¿‘ã„ï¼‰","è¿‘",[], "L12"),
      toObj("ã¨ãŠã„ï¼ˆé ã„ï¼‰","é ",[], "L12"),
      toObj("ã¯ã‚„ã„ï¼ˆé€Ÿã„ã€æ—©ã„ï¼‰","å¿«ã€æ—©",[], "L12"),
      toObj("ãŠãã„ï¼ˆé…ã„ï¼‰","æ…¢",[], "L12"),
      toObj("ãŠãŠã„[äººãŒã€œ]ï¼ˆå¤šã„[äººãŒã€œ]ï¼‰","ï¼ˆäººï¼‰å¤š",[], "L12"),
      toObj("ã™ããªã„[äººãŒã€œ]ï¼ˆå°‘ãªã„[äººãŒã€œ]ï¼‰","ï¼ˆäººï¼‰å°‘",[], "L12"),
      toObj("ã‚ãŸãŸã‹ã„ï¼ˆæš–ã‹ã„ã€æ¸©ã‹ã„ï¼‰","æº«æš–ã€æº«",[], "L12"),
      toObj("ã™ãšã—ã„ï¼ˆæ¶¼ã—ã„ï¼‰","æ¶¼å¿«",[], "L12"),
      toObj("ã‚ã¾ã„ï¼ˆç”˜ã„ï¼‰","ç”œ",[], "L12"),
      toObj("ã‹ã‚‰ã„ï¼ˆè¾›ã„ï¼‰","è¾£",[], "L12"),
      toObj("ãŠã‚‚ã„ï¼ˆé‡ã„ï¼‰","é‡",[], "L12"),
      toObj("ã‹ã‚‹ã„ï¼ˆè»½ã„ï¼‰","è¼•",[], "L12"),
      toObj("ã„ã„[ã‚³ãƒ¼ãƒ’ãƒ¼ãŒã€œ]","[å’–å•¡]å¥½ï¼ˆå…©è€…ä¸­é¸æ“‡ï¼‰",[], "L12"),
      toObj("ãã›ã¤ï¼ˆå­£ç¯€ï¼‰","å­£ç¯€",[], "L12"),
      toObj("ã¯ã‚‹ï¼ˆæ˜¥ï¼‰","æ˜¥å¤©",[], "L12"),
      toObj("ãªã¤ï¼ˆå¤ï¼‰","å¤å¤©",[], "L12"),
      toObj("ã‚ãï¼ˆç§‹ï¼‰","ç§‹å¤©",[], "L12"),
      toObj("ãµã‚†ï¼ˆå†¬ï¼‰","å†¬å¤©",[], "L12"),
      toObj("ã¦ã‚“ãï¼ˆå¤©æ°—ï¼‰","å¤©æ°£",[], "L12"),
      toObj("ã‚ã‚ï¼ˆé›¨ï¼‰","é›¨",[], "L12"),
      toObj("ã‚†ãï¼ˆé›ªï¼‰","é›ª",[], "L12"),
      toObj("ãã‚‚ã‚Šï¼ˆæ›‡ã‚Šï¼‰","é™°å¤©",[], "L12"),
      toObj("ãƒ›ãƒ†ãƒ«","é£¯åº—",[], "L12"),
      toObj("ãã†ã“ã†ï¼ˆç©ºæ¸¯ï¼‰","æ©Ÿå ´",[], "L12"),
      toObj("ã†ã¿ï¼ˆæµ·ï¼‰","æµ·",[], "L12"),
      toObj("ã›ã‹ã„ï¼ˆä¸–ç•Œï¼‰","ä¸–ç•Œ",[], "L12"),
      toObj("ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼","æ´¾å°ã€å®´æœƒï¼ˆã€œã‚’ã—ã¾ã™ï¼šèˆ‰è¾¦å®´æœƒï¼‰",[], "L12"),
      toObj("[ãŠ]ã¾ã¤ã‚Šï¼ˆ[ãŠ]ç¥­ã‚Šï¼‰","æ…¶å…¸ã€å»Ÿæœƒ",[], "L12"),
      toObj("ã™ãã‚„ãï¼ˆã™ãç„¼ãï¼‰","å£½å–œç‡’",[], "L12"),
      toObj("ã•ã—ã¿ï¼ˆåˆºèº«ï¼‰","ç”Ÿé­šç‰‡",[], "L12"),
      toObj("[ãŠ]ã™ã—","å£½å¸",[], "L12"),
      toObj("ã¦ã‚“ã·ã‚‰","å¤©å©¦ç¾…",[], "L12"),
      toObj("ã¶ãŸã«ãï¼ˆè±šè‚‰ï¼‰","è±¬è‚‰",[], "L12"),
      toObj("ã¨ã‚Šã«ãï¼ˆã¨ã‚Šè‚‰ï¼‰","é›è‚‰",[], "L12"),
      toObj("ãã‚…ã†ã«ãï¼ˆç‰›è‚‰ï¼‰","ç‰›è‚‰",[], "L12"),
      toObj("ãƒ¬ãƒ¢ãƒ³","æª¸æª¬",[], "L12"),
      toObj("ã„ã‘ã°ãªï¼ˆç”Ÿã‘èŠ±ï¼‰","æ’èŠ±ï¼ˆã€œã‚’ã—ã¾ã™ï¼šæ’èŠ±ï¼‰",[], "L12"),
      toObj("ã‚‚ã¿ã˜ï¼ˆç´…è‘‰ï¼‰","æ¥“è‘‰",[], "L12"),
      toObj("ã©ã¡ã‚‰","å“ªä¸€é‚Šï¼å“ªä¸€å€‹ï¼ˆå…©è€…æ“‡ä¸€ï¼‰",[], "L12"),
      toObj("ã©ã¡ã‚‰ã‚‚","å…©è€…éƒ½ã€œ",[], "L12"),
      toObj("ã„ã¡ã°ã‚“","æœ€ã€ç¬¬ä¸€",[], "L12"),
      toObj("ãšã£ã¨","ï½å¾—å¤šï¼ˆç”¨æ–¼æ¯”è¼ƒï¼‰",[], "L12"),
      toObj("ã¯ã˜ã‚ã¦ï¼ˆåˆã‚ã¦ï¼‰","ç¬¬ä¸€æ¬¡ã€åˆæ¬¡",[], "L12"),
    ];

    const ALL = [...L9, ...L10, ...L11, ...L12];

    // ========= State =========
    let mode = "jp2zh";
    let pool = [];
    let totalQ = 10;
    let qIndex = 0;
    let score = 0;
    let streak = 0, bestStreak = 0;
    let timed = false;
    let timeLeft = 60;
    let timerId = null;
    let wrongSet = [];
    let starSet = new Set(JSON.parse(localStorage.getItem("minna_L9_12_stars")||"[]"));

    const $ = (s, r=document)=>r.querySelector(s);
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }
    function sample(arr, n){ const a = arr.slice(); shuffle(a); return a.slice(0, n); }

    function renderBank(target, data){
      target.innerHTML = "";
      data.forEach(w=>{
        const d = document.createElement("div");
        d.className = "item";
        const jk = (w.kanji && w.kana && w.kanji!==w.kana ? `${w.kana}ï¼ˆ${w.kanji}ï¼‰` : w.jp);
        const btn = document.createElement("button");
        btn.className = "starbtn";
        btn.innerHTML = starSet.has(w.id) ? "â­ï¸" : "â˜†";
        if(starSet.has(w.id)) btn.classList.add("star-on");
        btn.onclick = ()=>{ toggleStar(w.id); btn.innerHTML = starSet.has(w.id) ? "â­ï¸" : "â˜†"; btn.classList.toggle("star-on", starSet.has(w.id)); };
        const left = document.createElement("div");
        left.innerHTML = `<div style="font-weight:900">${jk}</div><div>${w.zh}</div><div class="pill">${w.l}</div>`;
        d.appendChild(left); d.appendChild(btn);
        target.appendChild(d);
      });
    }
    function toggleStar(id){
      if(starSet.has(id)) starSet.delete(id); else starSet.add(id);
      localStorage.setItem("minna_L9_12_stars", JSON.stringify([...starSet]));
    }
    renderBank(document.getElementById("bankL9"), L9);
    renderBank(document.getElementById("bankL10"), L10);
    renderBank(document.getElementById("bankL11"), L11);
    renderBank(document.getElementById("bankL12"), L12);

    document.querySelectorAll('[data-q]').forEach(btn=>{
      btn.addEventListener('click',()=>{ totalQ = parseInt(btn.dataset.q,10); document.getElementById("qcount").textContent = "ç›®å‰ï¼š" + totalQ + " é¡Œ"; });
    });
    document.getElementById("startBtn").addEventListener("click", startQuiz);
    document.getElementById("speakBtn").addEventListener("click", speakPrompt);
    document.getElementById("restart").addEventListener("click", ()=>{ document.getElementById("summary").style.display="none"; document.getElementById("setup").style.display="block" });
    document.getElementById("retryWrong").addEventListener("click", retryWrongOnly);

    function buildPool(){
      const use9 = document.getElementById("useL9").checked;
      const use10 = document.getElementById("useL10").checked;
      const use11 = document.getElementById("useL11").checked;
      const use12 = document.getElementById("useL12").checked;
      const wantSuffix = document.getElementById("tagSuffix").checked;
      const wantCountry = document.getElementById("tagCountry").checked;
      const wantTime = document.getElementById("tagTime").checked;
      const onlyStar = document.getElementById("onlyStar").checked;

      let p = ALL.filter(w => (w.l==="L9" && use9) || (w.l==="L10" && use10) || (w.l==="L11" && use11) || (w.l==="L12" && use12));
      if(wantSuffix || wantCountry || wantTime){
        p = p.filter(w => {
          const hasS = w.tags.includes(T.SUFFIX);
          const hasC = w.tags.includes(T.COUNTRY);
          const hasT = w.tags.includes(T.TIME);
          return (wantSuffix&&hasS) || (wantCountry&&hasC) || (wantTime&&hasT);
        });
      }
      if(onlyStar){ p = p.filter(w=> starSet.has(w.id)); }
      const byLesson = document.getElementById("byLesson").checked;
      if(byLesson){
        const order = ["L9","L10","L11","L12"];
        p.sort((a,b)=> order.indexOf(a.l) - order.indexOf(b.l));
      }else{
        shuffle(p);
      }
      return p;
    }

    function startTimer(){
      if(!timed){ return; }
      clearInterval(timerId);
      document.getElementById("timeChip").style.display = "inline-block";
      document.getElementById("timeLeft").textContent = timeLeft;
      timerId = setInterval(()=>{
        timeLeft--;
        document.getElementById("timeLeft").textContent = timeLeft;
        if(timeLeft<=0){ clearInterval(timerId); endQuiz(true); }
      }, 1000);
    }
    function addBonusSeconds(n=3){
      if(!timed) return;
      timeLeft = Math.min(timeLeft + n, 999);
      document.getElementById("timeLeft").textContent = timeLeft;
      const t = document.createElement("span"); t.textContent = `+${n}s`; t.style.marginLeft="6px"; t.style.color="var(--ok)"; t.style.fontWeight="900";
      const chip = document.getElementById("timeChip"); chip.appendChild(t); setTimeout(()=>t.remove(), 600);
    }

    function startQuiz(){
      mode = document.querySelector('input[name="mode"]:checked').value;
      pool = buildPool();
      if(pool.length < 3){ alert("é¡Œåº«éå°ï¼šè«‹èª¿æ•´ç¯„åœæˆ–å–æ¶ˆéåº¦çš„æ¨™ç±¤/æ˜Ÿè™Ÿç¯©é¸ã€‚"); return; }
      timed = document.getElementById("timed").checked;
      timeLeft = 60;
      qIndex=0; score=0; streak=0; bestStreak=0; wrongSet = [];
      document.getElementById("score").textContent = "0"; document.getElementById("streak").textContent = "0";
      document.getElementById("setup").style.display="none";
      document.getElementById("quiz").style.display="block";
      document.getElementById("summary").style.display="none";
      document.getElementById("modeTag").textContent = mode==="jp2zh"?"JPâ†’ZH":(mode==="zh2jp"?"ZHâ†’JP":"æ¼¢å­—â†’å‡å");
      startTimer();
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("resultBox").style.display="none";
      document.getElementById("nextBtn").disabled = true;
      if(qIndex >= totalQ){ endQuiz(); return; }
      document.getElementById("meta").textContent = `ç¬¬ ${qIndex+1} / ${totalQ} é¡Œ`;
      document.getElementById("bar").style.width = ((qIndex)/totalQ)*100 + "%";

      const q = pool[Math.floor(Math.random()*pool.length)];
      let opts;
      const starBtnHTML = `<button class="starbtn ${starSet.has(q.id)?'star-on':''}" id="starQBtn" title="åŠ æ˜Ÿ">${starSet.has(q.id)?'â­ï¸':'â˜†'}</button>`;

      if(mode==="kanji2kana"){
        const prompt = q.kanji || q.jp;
        const distractors = sample(ALL.filter(w=> w.kana!==q.kana), 2);
        opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = prompt + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.kana), q.kana, q);
        document.getElementById("choices").dataset.prompt = q.kana;
      } else if(mode==="jp2zh"){
        const distractors = sample(ALL.filter(w=> w.zh!==q.zh), 2);
        opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = q.jp + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.zh), q.zh, q);
        document.getElementById("choices").dataset.prompt = q.jp;
      } else {
        const distractors = sample(ALL.filter(w=> w.jp!==q.jp), 2);
        opts = shuffle([q, ...distractors]);
        document.getElementById("qtext").innerHTML = q.zh + " " + starBtnHTML;
        renderChoices(opts.map(o=>o.jp), q.jp, q);
        document.getElementById("choices").dataset.prompt = q.jp;
      }

      const starBtn = document.getElementById("starQBtn");
      starBtn.onclick = ()=>{ toggleStar(q.id); starBtn.textContent = starSet.has(q.id) ? "â­ï¸" : "â˜†"; starBtn.classList.toggle("star-on", starSet.has(q.id)); };

      document.getElementById("nextBtn").onclick = ()=>{ qIndex++; nextQuestion(); };
    }

    function renderChoices(texts, correctText, qobj){
      const choices = document.getElementById("choices"); choices.innerHTML="";
      texts.forEach((txt, idx)=>{
        const div = document.createElement("div");
        div.className="choice";
        div.innerHTML = `<div class="key">${"ABC"[idx]}</div><div class="text">${txt}</div>`;
        div.addEventListener("click", ()=>onChoose(txt, correctText, qobj));
        choices.appendChild(div);
      });
    }
    function onChoose(chosenText, correctText, q){
      const ok = (chosenText === correctText);
      const box = document.getElementById("resultBox");
      const head = document.getElementById("resHead");
      const body = document.getElementById("resBody");
      if(ok){
        score++; streak++; bestStreak = Math.max(bestStreak, streak);
        document.getElementById("score").textContent = score; document.getElementById("streak").textContent = streak;
        box.classList.remove("bad"); box.classList.add("ok");
        head.textContent = "âœ… æ­£ç¢ºï¼";
        if(timed) addBonusSeconds(3);
      }else{
        streak=0; document.getElementById("streak").textContent = streak;
        box.classList.remove("ok"); box.classList.add("bad");
        head.textContent = "âŒ ç­”éŒ¯äº†";
        wrongSet.push(q);
      }
      if(mode==="kanji2kana"){
        body.textContent = `${q.kanji} â†’ ${q.kana}ï½œ${q.zh}`;
      }else if(mode==="jp2zh"){
        body.textContent = `${q.jp} â†’ ${q.zh}`;
      }else{
        body.textContent = `${q.zh} â†’ ${q.jp}`;
      }
      box.style.display="block";
      document.getElementById("nextBtn").disabled = false;
    }

    function endQuiz(timeUp=false){
      clearInterval(timerId); timerId=null;
      document.getElementById("quiz").style.display="none";
      document.getElementById("summary").style.display="block";
      document.getElementById("finalScore").textContent = score;
      document.getElementById("finalTotal").textContent = totalQ;
      document.getElementById("finalStreak").textContent = bestStreak;
      document.getElementById("bar").style.width = "100%";
      document.getElementById("timeChip").style.display = "none";
      const btn = document.getElementById("retryWrong");
      btn.disabled = wrongSet.length===0;
      if(timeUp){ alert("æ™‚é–“åˆ°ï¼çœ‹çœ‹é€™å›åˆæˆç¸¾ï½"); }
    }
    function retryWrongOnly(){
      if(wrongSet.length===0){ alert("æ²’æœ‰éŒ¯é¡Œå¯é‡ç·´ï¼"); return; }
      const map = new Map(); wrongSet.forEach(w=>map.set(w.id,w));
      pool = [...map.values()];
      timed = false;
      qIndex=0; score=0; streak=0; bestStreak=0;
      document.getElementById("score").textContent = "0";
      document.getElementById("streak").textContent = "0";
      document.getElementById("summary").style.display="none";
      document.getElementById("quiz").style.display="block";
      nextQuestion();
    }

    function speakPrompt(){
      const utter = new SpeechSynthesisUtterance(document.getElementById("choices").dataset.prompt || "");
      utter.lang = "ja-JP";
      speechSynthesis.stop();
      speechSynthesis.speak(utter);
    }
  </script>
</body>
</html>
